generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("account")
}

model CatalogoEquipo {
  id                                  String                                @id
  categoriaId                         String
  unidadId                            String
  codigo                              String                                @unique
  descripcion                         String
  marca                               String
  precioInterno                       Float
  margen                              Float
  precioVenta                         Float
  estado                              String
  precioReal                          Float?
  fechaActualizacion                  DateTime?
  createdAt                           DateTime                              @default(now())
  updatedAt                           DateTime
  categoriaEquipo                     CategoriaEquipo                       @relation(fields: [categoriaId], references: [id])
  unidad                              Unidad                                @relation(fields: [unidadId], references: [id])
  cotizacionEquipoItem                CotizacionEquipoItem[]
  plantillaEquipoItem                 PlantillaEquipoItem[]
  proyectoEquipoCotizadoItem          ProyectoEquipoCotizadoItem[]
  plantillaEquipoItemIndependiente PlantillaEquipoItemIndependiente[]
  listaEquipoItem                     ListaEquipoItem[]

  @@map("catalogo_equipo")
}

model CatalogoServicio {
  id                                    String                                  @id
  categoriaId                           String
  unidadServicioId                      String
  recursoId                             String
  nombre                                String
  descripcion                           String
  horaBase                              Float?
  horaRepetido                          Float?
  createdAt                             DateTime                                @default(now())
  updatedAt                             DateTime
  orden                                 Int?                                    @default(0)
  cantidad                              Float?
  nivelDificultad                       Int?                                    @default(1)
  edt                                   Edt                                     @relation(fields: [categoriaId], references: [id])
  recurso                               Recurso                                 @relation(fields: [recursoId], references: [id])
  unidadServicio                        UnidadServicio                          @relation(fields: [unidadServicioId], references: [id])
  cotizacionServicioItem                CotizacionServicioItem[]
  plantillaServicioItem                 PlantillaServicioItem[]
  proyectoServicioCotizadoItem          ProyectoServicioCotizadoItem[]
  plantillaServicioItemIndependiente PlantillaServicioItemIndependiente[]

  @@map("catalogo_servicio")
}

model CategoriaEquipo {
  id             String           @id
  nombre         String           @unique
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  descripcion    String?
  catalogoEquipo CatalogoEquipo[]

  @@map("categoria_equipo")
}

model Cliente {
  id                       String                   @id
  codigo                   String                   @unique
  numeroSecuencia          Int?                     @default(1)
  nombre                   String
  ruc                      String?
  direccion                String?
  telefono                 String?
  correo                   String?
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  calificacion             Int?                     @default(3)
  estadoRelacion           String                   @default("prospecto")
  frecuenciaCompra         String?
  linkedin                 String?
  potencialAnual           Float?
  sector                   String?
  sitioWeb                 String?
  tamanoEmpresa            String?
  ultimoProyecto           DateTime?
  calificacionSatisfaccion Int?                     @default(3)
  frecuenciaCompraMeses    Int?
  cotizacion               Cotizacion[]
  proyecto                 Proyecto[]
  crmContactoCliente       CrmContactoCliente[]
  crmHistorialProyecto     CrmHistorialProyecto[]
  crmOportunidad           CrmOportunidad[]

  @@map("cliente")
}

model Cotizacion {
  id                          String                        @id
  clienteId                   String?
  comercialId                 String?
  plantillaId                 String?
  codigo                      String                        @unique
  numeroSecuencia             Int
  nombre                      String
  totalEquiposInterno         Float                         @default(0)
  totalEquiposCliente         Float                         @default(0)
  totalServiciosInterno       Float                         @default(0)
  totalServiciosCliente       Float                         @default(0)
  totalGastosInterno          Float                         @default(0)
  totalGastosCliente          Float                         @default(0)
  totalInterno                Float                         @default(0)
  totalCliente                Float                         @default(0)
  descuento                   Float                         @default(0)
  grandTotal                  Float                         @default(0)
  prioridad                   String?
  probabilidad                Int?
  fechaEnvio                  DateTime?
  fechaCierreEstimada         DateTime?
  notas                       String?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  fechaValidezHasta           DateTime?
  formaPago                   String?
  incluyeIGV                  Boolean?                      @default(false)
  moneda                      String?                       @default("USD")
  referencia                  String?
  revision                    String?                       @default("R01")
  validezOferta               Int?                          @default(15)
  competencia                 String?
  fechaProximaAccion          DateTime?
  fechaUltimoContacto         DateTime?
  posicionVsCompetencia       String?
  prioridadCrm                String?                       @default("media")
  probabilidadCierre          Int?                          @default(0)
  proximaAccion               String?
  razonCierre                 String?
  retroalimentacionCliente    String?
  calendarioLaboralId         String?
  fechaFin                    DateTime?
  fechaInicio                 DateTime?
  estado                      EstadoCotizacion              @default(borrador)
  calendarioLaboral           CalendarioLaboral?           @relation(fields: [calendarioLaboralId], references: [id])
  cliente                     Cliente?                      @relation(fields: [clienteId], references: [id])
  user                        User?                         @relation(fields: [comercialId], references: [id])
  plantilla                   Plantilla?                    @relation(fields: [plantillaId], references: [id])
  cotizacionEquipo            CotizacionEquipo[]
  cotizacionGasto             CotizacionGasto[]
  cotizacionServicio          CotizacionServicio[]
  proyecto                    Proyecto[]
  cotizacionCondicion        CotizacionCondicion[]
  cotizacionEdt              CotizacionEdt[]
  cotizacionExclusion        CotizacionExclusion[]
  cotizacionFase             CotizacionFase[]
  cotizacionPlantillaImport  CotizacionPlantillaImport[]
  cotizacionVersion          CotizacionVersion[]
  crmCompetidorLicitacion     CrmCompetidorLicitacion[]
  crmHistorialProyecto        CrmHistorialProyecto[]
  crmOportunidad              CrmOportunidad?

  @@map("cotizacion")
}

model CotizacionEquipo {
  id                   String                 @id
  cotizacionId         String
  nombre               String
  descripcion          String?
  subtotalInterno      Float
  subtotalCliente      Float
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  plazoEntregaSemanas  Int?
  cotizacion           Cotizacion             @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)
  cotizacionEquipoItem                CotizacionEquipoItem[]

  @@map("cotizacion_equipo")
}

model CotizacionEquipoItem {
  id                 String           @id
  cotizacionEquipoId String
  catalogoEquipoId   String?
  codigo             String
  descripcion        String
  categoria          String
  unidad             String
  marca              String
  precioInterno      Float
  precioCliente      Float
  cantidad           Float
  costoInterno       Float
  costoCliente       Float
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  catalogoEquipo     CatalogoEquipo?  @relation(fields: [catalogoEquipoId], references: [id])
  cotizacionEquipo   CotizacionEquipo @relation(fields: [cotizacionEquipoId], references: [id], onDelete: Cascade)

  @@map("cotizacion_equipo_item")
}

model CotizacionGasto {
  id                  String                @id
  cotizacionId        String
  nombre              String
  descripcion         String?
  subtotalInterno     Float
  subtotalCliente     Float
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  plazoEntregaSemanas Int?
  cotizacion          Cotizacion            @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)
  cotizacionGastoItem CotizacionGastoItem[]

  @@map("cotizacion_gasto")
}

model CotizacionGastoItem {
  id              String          @id
  gastoId         String
  nombre          String
  descripcion     String?
  cantidad        Float
  precioUnitario  Float
  factorSeguridad Float           @default(1.0)
  margen          Float           @default(1.0)
  costoInterno    Float
  costoCliente    Float
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  cotizacionGasto CotizacionGasto @relation(fields: [gastoId], references: [id], onDelete: Cascade)

  @@map("cotizacion_gasto_item")
}

model CotizacionProveedor {
  id                      String                    @id
  proveedorId             String
  proyectoId              String
  codigo                  String                    @unique
  numeroSecuencia         Int
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  estado                  EstadoCotizacionProveedor @default(pendiente)
  proveedor               Proveedor                 @relation(fields: [proveedorId], references: [id])
  proyecto                Proyecto                  @relation(fields: [proyectoId], references: [id])
  cotizacionProveedorItem    CotizacionProveedorItem[]

  @@map("cotizacion_proveedor")
}

model CotizacionProveedorItem {
  id                                                                                String                    @id
  cotizacionId                                                                      String
  listaEquipoItemId                                                                 String?
  codigo                                                                            String
  descripcion                                                                       String
  unidad                                                                            String
  cantidadOriginal                                                                  Float
  precioUnitario                                                                    Float?
  cantidad                                                                          Float?
  costoTotal                                                                        Float?
  tiempoEntrega                                                                     String?
  tiempoEntregaDias                                                                 Int?
  estado                                                                            EstadoCotizacionProveedor @default(pendiente)
  esSeleccionada                                                                    Boolean?                  @default(false)
  createdAt                                                                         DateTime                  @default(now())
  updatedAt                                                                         DateTime
  listaId                                                                           String?
  cotizacionProveedor            CotizacionProveedor  @relation(fields: [cotizacionId], references: [id])
  listaEquipoItem                ListaEquipoItem?     @relation("cotizacionProveedorItemListaEquipoItem", fields: [listaEquipoItemId], references: [id])
  listaEquipo                    ListaEquipo?         @relation(fields: [listaId], references: [id])
  cotizacionSeleccionadaItems    ListaEquipoItem?     @relation("listaEquipoItemCotizacionSeleccionada")

  @@map("cotizacion_proveedor_item")
}

model CotizacionServicio {
  id                     String                   @id
  cotizacionId           String
  nombre                 String
  edtId                  String
  subtotalInterno        Float
  subtotalCliente        Float
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  plazoEntregaSemanas    Int?
  cotizacion             Cotizacion               @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)
  edt                    Edt                      @relation("CotizacionServicioEdt", fields: [edtId], references: [id])
  cotizacionServicioItem CotizacionServicioItem[]
  cotizacionEdt          CotizacionEdt[]

  @@map("cotizacion_servicio")
}

model CotizacionServicioItem {
  id                   String             @id
  cotizacionServicioId String
  catalogoServicioId   String?
  unidadServicioId     String
  recursoId            String
  nombre               String
  descripcion          String
  edtId                String
  unidadServicioNombre String
  recursoNombre        String
  formula              String
  horaBase             Float?
  horaRepetido         Float?
  horaUnidad           Float?
  horaFijo             Float?
  costoHora            Float
  cantidad             Int
  horaTotal            Float
  factorSeguridad      Float
  margen               Float
  costoInterno         Float
  costoCliente         Float
  createdAt            DateTime           @default(now())
  updatedAt            DateTime
  orden                Int?               @default(0)
  nivelDificultad      Int?               @default(1)
  catalogoServicio     CatalogoServicio?  @relation(fields: [catalogoServicioId], references: [id])
  cotizacionServicio   CotizacionServicio @relation(fields: [cotizacionServicioId], references: [id], onDelete: Cascade)
  edt                  Edt                @relation("CotizacionServicioItemEdt", fields: [edtId], references: [id])
  recurso              Recurso            @relation(fields: [recursoId], references: [id])
  unidadServicio       UnidadServicio     @relation(fields: [unidadServicioId], references: [id])
  cotizacionTarea      CotizacionTarea[]

  @@map("cotizacion_servicio_item")
}

model EntregaItem {
  id                 String               @id
  pedidoEquipoItemId String
  listaEquipoItemId  String?
  proyectoId         String
  fechaEntrega       DateTime
  estado             EstadoEntregaItem    @default(pendiente)
  cantidad           Float
  cantidadEntregada  Float?               @default(0)
  observaciones      String?
  fechaRegistro      DateTime             @default(now())
  usuarioId          String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  listaEquipoItem    ListaEquipoItem?     @relation(fields: [listaEquipoItemId], references: [id])
  pedidoEquipoItem   PedidoEquipoItem     @relation(fields: [pedidoEquipoItemId], references: [id])
  proyecto                    Proyecto             @relation(fields: [proyectoId], references: [id])
  user                        User?                @relation(fields: [usuarioId], references: [id])
  eventoTrazabilidad              EventoTrazabilidad[]

  @@index([fechaEntrega])
  @@index([pedidoEquipoItemId])
  @@index([proyectoId, estado])
  @@map("entrega_item")
}

model EventoTrazabilidad {
  id             String             @id
  entregaItemId  String?
  proyectoId     String?
  tipo           String
  descripcion    String
  estadoAnterior EstadoEntregaItem?
  estadoNuevo    EstadoEntregaItem?
  fechaEvento    DateTime           @default(now())
  usuarioId      String
  metadata       Json?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime
  entregaItem    EntregaItem?       @relation(fields: [entregaItemId], references: [id])
  proyecto                    Proyecto?          @relation(fields: [proyectoId], references: [id])
  user                        User               @relation(fields: [usuarioId], references: [id])

  @@index([entregaItemId])
  @@index([fechaEvento])
  @@index([proyectoId])
  @@index([tipo, fechaEvento])
  @@map("evento_trazabilidad")
}

model ListaEquipo {
  id                         String                       @id
  proyectoId                 String
  codigo                     String                       @unique
  nombre                     String
  numeroSecuencia            Int
  estado                     EstadoListaEquipo            @default(borrador)
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  responsableId              String
  fechaAprobacionFinal       DateTime?
  fechaAprobacionRevision    DateTime?
  fechaEnvioLogistica        DateTime?
  fechaEnvioRevision         DateTime?
  fechaFinCotizacion         DateTime?
  fechaInicioCotizacion      DateTime?
  fechaNecesaria             DateTime?
  fechaValidacion            DateTime?
  cotizacionProveedorItem    CotizacionProveedorItem[]
  proyecto                    Proyecto                     @relation(fields: [proyectoId], references: [id], onDelete: Cascade)
  user                        User                         @relation(fields: [responsableId], references: [id])
  listaEquipoItem            ListaEquipoItem[]
  pedidoEquipo               PedidoEquipo[]
  pedidoEquipoItem           PedidoEquipoItem[]
  proyectoEquipoCotizadoItem          ProyectoEquipoCotizadoItem[]

  @@index([estado, fechaNecesaria, createdAt(sort: Desc)], map: "idx_lista_estado_necesaria_fecha")
  @@index([proyectoId, estado, createdAt(sort: Desc)], map: "idx_lista_proyecto_estado_fecha")
  @@index([responsableId, estado, fechaAprobacionFinal], map: "idx_lista_responsable_estado_aprobacion")
  @@map("lista_equipo")
}

model ListaEquipoItem {
  id                                                                                                           String                       @id @default(cuid())
  listaId                                                                                                      String
  proyectoEquipoId                                                                                             String?
  proyectoEquipoItemId                                                                                         String?
  proveedorId                                                                                                  String?
  cotizacionSeleccionadaId                                                                                     String?                      @unique
  catalogoEquipoId                                                                                             String?
  codigo                                                                                                       String
  descripcion                                                                                                  String
  categoria                                                                                                    String                       @default("SIN-CATEGORIA")
  unidad                                                                                                       String
  marca                                                                                                        String                       @default("SIN-MARCA")
  cantidad                                                                                                     Float
  verificado                                                                                                   Boolean                      @default(false)
  comentarioRevision                                                                                           String?
  presupuesto                                                                                                  Float?
  precioElegido                                                                                                Float?
  costoElegido                                                                                                 Float?
  costoPedido                                                                                                  Float?                       @default(0)
  costoReal                                                                                                    Float?                       @default(0)
  cantidadPedida                                                                                               Float?                       @default(0)
  cantidadEntregada                                                                                            Float?                       @default(0)
  estado                                                                                                       EstadoListaItem              @default(borrador)
  createdAt                                                                                                    DateTime                     @default(now())
  updatedAt                                                                                                    DateTime
  origen                                                                                                       OrigenListaItem              @default(nuevo)
  tiempoEntrega                                                                                                String?
  tiempoEntregaDias                                                                                            Int?
  responsableId                                                                                                String
  reemplazaProyectoEquipoCotizadoItemId                                                                        String?
  cotizacionProveedorItems                 CotizacionProveedorItem[]    @relation("cotizacionProveedorItemListaEquipoItem")
  entregaItem                              EntregaItem[]
  cotizacionSeleccionada                   CotizacionProveedorItem?     @relation("listaEquipoItemCotizacionSeleccionada", fields: [cotizacionSeleccionadaId], references: [id])
  listaEquipo                              ListaEquipo                  @relation(fields: [listaId], references: [id], onDelete: Cascade)
  proveedor                                Proveedor?                   @relation(fields: [proveedorId], references: [id])
  proyectoEquipoCotizado                   ProyectoEquipoCotizado?      @relation(fields: [proyectoEquipoId], references: [id])
  proyectoEquipoItem                       ProyectoEquipoCotizadoItem?  @relation("listaEquipoItemProyectoEquipoItem", fields: [proyectoEquipoItemId], references: [id])
  reemplazaProyectoEquipoCotizadoItem      ProyectoEquipoCotizadoItem?  @relation("listaEquipoItemReemplazaProyectoEquipoItem", fields: [reemplazaProyectoEquipoCotizadoItemId], references: [id])
  user                                     User                         @relation(fields: [responsableId], references: [id])
  pedidoEquipoItem                         PedidoEquipoItem[]
  listaEquipoItemSeleccionados             ProyectoEquipoCotizadoItem[] @relation("proyectoEquipoCotizadoItemListaEquipoSeleccionado")
  catalogoEquipo                           CatalogoEquipo?              @relation(fields: [catalogoEquipoId], references: [id])

  @@index([listaId, estado, createdAt(sort: Desc)], map: "idx_lista_item_lista_estado_fecha")
  @@index([proveedorId, estado, precioElegido], map: "idx_lista_item_proveedor_estado_precio")
  @@index([responsableId, estado, verificado], map: "idx_lista_item_responsable_estado_verificado")
  @@map("lista_equipo_item")
}

model PedidoEquipo {
  id                   String             @id
  proyectoId           String
  responsableId        String
  listaId              String?
  codigo               String             @unique
  numeroSecuencia      Int
  estado               EstadoPedido       @default(borrador)
  fechaPedido          DateTime           @default(now())
  observacion          String?
  fechaEntregaEstimada DateTime?
  fechaEntregaReal     DateTime?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime
  fechaNecesaria       DateTime
  costoRealTotal       Float              @default(0)
  esUrgente            Boolean            @default(false)
  presupuestoTotal     Float              @default(0)
  prioridad            String?            @default("media")
  listaEquipo          ListaEquipo?       @relation(fields: [listaId], references: [id])
  proyecto                    Proyecto           @relation(fields: [proyectoId], references: [id])
  user                        User               @relation(fields: [responsableId], references: [id])
  pedidoEquipoItem     PedidoEquipoItem[]

  @@index([estado, prioridad, createdAt(sort: Desc)], map: "idx_pedido_estado_prioridad_fecha")
  @@index([proyectoId, estado, createdAt(sort: Desc)], map: "idx_pedido_proyecto_estado_fecha")
  @@index([proyectoId, responsableId, estado], map: "idx_pedido_proyecto_responsable_estado")
  @@index([responsableId, estado, fechaNecesaria], map: "idx_pedido_responsable_estado_fecha")
  @@map("pedido_equipo")
}

model PedidoEquipoItem {
  id                          String            @id
  pedidoId                    String
  listaEquipoItemId           String?
  cantidadPedida              Float
  precioUnitario              Float?
  costoTotal                  Float?
  estado                      EstadoPedidoItem  @default(pendiente)
  cantidadAtendida            Float?
  comentarioLogistica         String?
  createdAt                   DateTime          @default(now())
  updatedAt                   DateTime
  listaId                     String?
  codigo                      String
  descripcion                 String
  tiempoEntrega               String?
  tiempoEntregaDias           Int?
  unidad                      String
  fechaOrdenCompraRecomendada DateTime?
  responsableId               String
  fechaEntregaEstimada        DateTime?
  fechaEntregaReal            DateTime?
  estadoEntrega               EstadoEntregaItem @default(pendiente)
  observacionesEntrega        String?
  entregaItem                 EntregaItem[]
  listaEquipoItem             ListaEquipoItem?  @relation(fields: [listaEquipoItemId], references: [id])
  listaEquipo                 ListaEquipo?      @relation(fields: [listaId], references: [id])
  pedidoEquipo                PedidoEquipo      @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  user                        User              @relation(fields: [responsableId], references: [id])

  @@map("pedido_equipo_item")
}

model Plantilla {
  id                          String                        @id
  nombre                      String
  estado                      String                        @default("borrador")
  totalEquiposInterno         Float                         @default(0)
  totalEquiposCliente         Float                         @default(0)
  totalServiciosInterno       Float                         @default(0)
  totalServiciosCliente       Float                         @default(0)
  totalGastosInterno          Float                         @default(0)
  totalGastosCliente          Float                         @default(0)
  totalInterno                Float                         @default(0)
  totalCliente                Float                         @default(0)
  descuento                   Float                         @default(0)
  grandTotal                  Float                         @default(0)
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  tipo                        PlantillaTipo                 @default(completa)
  cotizacion                  Cotizacion[]
  plantillaEquipo             PlantillaEquipo[]
  plantillaGasto              PlantillaGasto[]
  plantillaServicio           PlantillaServicio[]
  cotizacionPlantillaImport CotizacionPlantillaImport[]

  @@map("plantilla")
}

model PlantillaEquipo {
  id                  String                @id
  plantillaId         String
  nombre              String
  descripcion         String?
  subtotalInterno     Float
  subtotalCliente     Float
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  plantilla                   Plantilla             @relation(fields: [plantillaId], references: [id], onDelete: Cascade)
  plantillaEquipoItem                 PlantillaEquipoItem[]

  @@map("plantilla_equipo")
}

model PlantillaEquipoItem {
  id                String          @id
  plantillaEquipoId String
  catalogoEquipoId  String?
  codigo            String
  descripcion       String
  categoria         String
  unidad            String
  marca             String
  precioInterno     Float
  precioCliente     Float
  cantidad          Float
  costoInterno      Float
  costoCliente      Float
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  catalogoEquipo    CatalogoEquipo? @relation(fields: [catalogoEquipoId], references: [id])
  plantillaEquipo   PlantillaEquipo @relation(fields: [plantillaEquipoId], references: [id], onDelete: Cascade)

  @@map("plantilla_equipo_item")
}

model PlantillaGasto {
  id                 String               @id
  plantillaId        String
  nombre             String
  descripcion        String?
  subtotalInterno    Float
  subtotalCliente    Float
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  plantilla                   Plantilla            @relation(fields: [plantillaId], references: [id], onDelete: Cascade)
  plantillaGastoItem PlantillaGastoItem[]

  @@map("plantilla_gasto")
}

model PlantillaGastoItem {
  id              String         @id
  gastoId         String
  nombre          String
  descripcion     String?
  cantidad        Float
  precioUnitario  Float
  factorSeguridad Float          @default(1.0)
  margen          Float          @default(1.0)
  costoInterno    Float
  costoCliente    Float
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  plantillaGasto  PlantillaGasto @relation(fields: [gastoId], references: [id], onDelete: Cascade)

  @@map("plantilla_gasto_item")
}

model PlantillaServicio {
  id                    String                  @id
  plantillaId           String
  nombre                String
  categoria             String
  descripcion           String?
  subtotalInterno       Float
  subtotalCliente       Float
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  plantilla                   Plantilla               @relation(fields: [plantillaId], references: [id], onDelete: Cascade)
  plantillaServicioItem                 PlantillaServicioItem[]

  @@map("plantilla_servicio")
}

model PlantillaServicioItem {
  id                   String            @id
  plantillaServicioId  String
  catalogoServicioId   String?
  unidadServicioId     String
  recursoId            String
  nombre               String
  descripcion          String
  categoria            String
  unidadServicioNombre String
  recursoNombre        String
  formula              String
  horaBase             Float?
  horaRepetido         Float?
  horaUnidad           Float?
  horaFijo             Float?
  costoHora            Float
  cantidad             Int
  horaTotal            Float
  factorSeguridad      Float
  margen               Float
  costoInterno         Float
  costoCliente         Float
  createdAt            DateTime          @default(now())
  updatedAt            DateTime
  catalogoServicio     CatalogoServicio? @relation(fields: [catalogoServicioId], references: [id])
  plantillaServicio    PlantillaServicio @relation(fields: [plantillaServicioId], references: [id], onDelete: Cascade)
  recurso                     Recurso           @relation(fields: [recursoId], references: [id])
  unidadServicio       UnidadServicio    @relation(fields: [unidadServicioId], references: [id])

  @@map("plantilla_servicio_item")
}

model Proveedor {
  id                  String                @id
  nombre              String
  ruc                 String?
  direccion           String?
  telefono            String?
  correo              String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  cotizacionProveedor CotizacionProveedor[]
  listaEquipoItem     ListaEquipoItem[]

  @@map("proveedor")
}

model Proyecto {
  id                              String                     @id
  clienteId                       String
  comercialId                     String
  gestorId                        String
  supervisorId                    String?
  liderId                         String?
  cotizacionId                    String?
  nombre                          String
  totalEquiposInterno             Float                      @default(0)
  totalServiciosInterno           Float                      @default(0)
  totalGastosInterno              Float                      @default(0)
  totalInterno                    Float                      @default(0)
  totalCliente                    Float                      @default(0)
  descuento                       Float                      @default(0)
  grandTotal                      Float                      @default(0)
  codigo                          String
  estado                          ProyectoEstado             @default(creado)
  fechaInicio                     DateTime
  fechaFin                        DateTime?
  totalRealEquipos                Float                      @default(0)
  totalRealServicios              Float                      @default(0)
  totalRealGastos                 Float                      @default(0)
  totalReal                       Float                      @default(0)
  createdAt                       DateTime                   @default(now())
  updatedAt                       DateTime
  deletedAt                       DateTime?
  progresoGeneral                 Int                        @default(0)
  cotizacionProveedor             CotizacionProveedor[]
  entregaItem                     EntregaItem[]
  eventoTrazabilidad              EventoTrazabilidad[]
  listaEquipo                     ListaEquipo[]
  pedidoEquipo                    PedidoEquipo[]
  cliente                     Cliente                    @relation(fields: [clienteId], references: [id])
  comercial                   User                       @relation("ProyectoComercial", fields: [comercialId], references: [id])
  cotizacion                  Cotizacion?                @relation(fields: [cotizacionId], references: [id])
  gestor                      User                       @relation("ProyectoGestor", fields: [gestorId], references: [id])
  supervisor                  User?                      @relation("ProyectoSupervisor", fields: [supervisorId], references: [id])
  lider                       User?                      @relation("ProyectoLider", fields: [liderId], references: [id])
  personalProyecto            PersonalProyecto[]
  proyectoEquipoCotizado          ProyectoEquipoCotizado[]
  proyectoGastoCotizado           ProyectoGastoCotizado[]
  proyectoServicioCotizado        ProyectoServicioCotizado[]
  registroHoras                   RegistroHoras[]
  valorizacion                    Valorizacion[]
  crmHistorialProyecto            CrmHistorialProyecto[]
  crmOportunidad                  CrmOportunidad[]
  proyectoCronograma             ProyectoCronograma[]
  proyectoEdt                    ProyectoEdt[]
  proyectoFase                   ProyectoFase[]

  @@index([clienteId, estado, createdAt(sort: Desc)], map: "idx_proyecto_cliente_estado_fecha")
  @@index([comercialId, estado, fechaInicio], map: "idx_proyecto_comercial_estado_inicio")
  @@index([estado, fechaInicio, createdAt(sort: Desc)], map: "idx_proyecto_estado_inicio_fecha")
  @@index([gestorId, estado, fechaFin], map: "idx_proyecto_gestor_estado_fin")
  @@index([supervisorId], map: "idx_proyecto_supervisor")
  @@index([liderId], map: "idx_proyecto_lider")
  @@map("proyecto")
}

// Personal asignado al proyecto (roles din√°micos)
model PersonalProyecto {
  id              String               @id @default(cuid())
  proyectoId      String
  userId          String
  rol             RolPersonalProyecto
  fechaAsignacion DateTime             @default(now())
  fechaFin        DateTime?
  activo          Boolean              @default(true)
  notas           String?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  proyecto        Proyecto             @relation(fields: [proyectoId], references: [id], onDelete: Cascade)
  user            User                 @relation(fields: [userId], references: [id])

  @@unique([proyectoId, userId, rol])
  @@index([proyectoId, activo])
  @@index([userId, activo])
  @@map("personal_proyecto")
}

enum RolPersonalProyecto {
  programador
  cadista
  ingeniero
  lider
  tecnico
  coordinador
  asistente
}

model ProyectoEquipoCotizado {
  id                         String                       @id
  proyectoId                 String
  responsableId              String
  nombre                     String
  descripcion                String?
  subtotalInterno            Float
  subtotalCliente            Float
  subtotalReal               Float                        @default(0)
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  listaEquipoItem            ListaEquipoItem[]
  proyecto                    Proyecto                     @relation(fields: [proyectoId], references: [id])
  user                        User                         @relation(fields: [responsableId], references: [id])
  proyectoEquipoCotizadoItem          ProyectoEquipoCotizadoItem[]

  @@map("proyecto_equipo_cotizado")
}

model ProyectoEquipoCotizadoItem {
  id                                                                                                String                 @id
  proyectoEquipoId                                                                                  String
  catalogoEquipoId                                                                                  String?
  listaId                                                                                           String?
  codigo                                                                                            String
  descripcion                                                                                       String
  categoria                                                                                         String                 @default("SIN-CATEGORIA")
  unidad                                                                                            String
  marca                                                                                             String                 @default("SIN-MARCA")
  precioInterno                                                                                     Float
  precioCliente                                                                                     Float
  cantidad                                                                                          Float
  costoInterno                                                                                      Float
  costoCliente                                                                                      Float
  precioReal                                                                                        Float                  @default(0)
  cantidadReal                                                                                      Float                  @default(0)
  costoReal                                                                                         Float                  @default(0)
  tiempoEntrega                                                                                     Int?
  fechaEntregaEstimada                                                                              DateTime?
  estado                                                                                            EstadoEquipoItem       @default(pendiente)
  motivoCambio                                                                                      String?
  createdAt                                                                                         DateTime               @default(now())
  updatedAt                                                                                         DateTime
  listaEquipoSeleccionadoId                                                                         String?
  listaEquipoItemsAsociados      ListaEquipoItem[]      @relation("listaEquipoItemProyectoEquipoItem")
  listaEquipoItemsReemplazo      ListaEquipoItem[]      @relation("listaEquipoItemReemplazaProyectoEquipoItem")
  catalogoEquipo                 CatalogoEquipo?        @relation(fields: [catalogoEquipoId], references: [id])
  listaEquipoSeleccionado        ListaEquipoItem?       @relation("proyectoEquipoCotizadoItemListaEquipoSeleccionado", fields: [listaEquipoSeleccionadoId], references: [id])
  listaEquipo                    ListaEquipo?           @relation(fields: [listaId], references: [id])
  proyectoEquipoCotizado         ProyectoEquipoCotizado @relation(fields: [proyectoEquipoId], references: [id], onDelete: Cascade)

  @@map("proyecto_equipo_cotizado_item")
}

model ProyectoGastoCotizado {
  id                        String                      @id
  proyectoId                String
  nombre                    String
  descripcion               String?
  subtotalInterno           Float
  subtotalCliente           Float
  subtotalReal              Float                       @default(0)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  proyecto                    Proyecto                    @relation(fields: [proyectoId], references: [id])
  proyectoGastoCotizadoItem ProyectoGastoCotizadoItem[]

  @@map("proyecto_gasto_cotizado")
}

model ProyectoGastoCotizadoItem {
  id                    String                @id
  gastoId               String
  nombre                String
  descripcion           String?
  cantidad              Float
  precioUnitario        Float
  factorSeguridad       Float
  margen                Float
  costoInterno          Float
  costoCliente          Float
  costoReal             Float                 @default(0)
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  proyectoGastoCotizado ProyectoGastoCotizado @relation(fields: [gastoId], references: [id])

  @@map("proyecto_gasto_cotizado_item")
}

model ProyectoServicioCotizado {
  id                           String                         @id
  proyectoId                   String
  responsableId                String
  nombre                       String
  edtId                        String
  subtotalInterno              Float
  subtotalCliente              Float
  subtotalReal                 Float                          @default(0)
  createdAt                    DateTime                       @default(now())
  updatedAt                    DateTime
  proyecto                    Proyecto                       @relation(fields: [proyectoId], references: [id])
  user                        User                           @relation(fields: [responsableId], references: [id])
  edt                         Edt                            @relation("ProyectoServicioCotizadoEdt", fields: [edtId], references: [id])
  proyectoServicioCotizadoItem          ProyectoServicioCotizadoItem[]
  registroHoras                   RegistroHoras[]
  tareas                       Tarea[]

  @@map("proyecto_servicio_cotizado")
}

model ProyectoServicioCotizadoItem {
  id                       String                   @id
  proyectoServicioId       String
  catalogoServicioId       String?
  edtId                    String
  costoHoraInterno         Float
  costoHoraCliente         Float
  nombre                   String
  cantidadHoras            Int
  costoInterno             Float
  costoCliente             Float
  costoReal                Float                    @default(0)
  horasEjecutadas          Float                    @default(0)
  motivoCambio             String?
  nuevo                    Boolean                  @default(false)
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  catalogoServicio         CatalogoServicio?        @relation(fields: [catalogoServicioId], references: [id])
  proyectoServicioCotizado ProyectoServicioCotizado @relation(fields: [proyectoServicioId], references: [id])
  edt                      Edt                      @relation("ProyectoServicioCotizadoItemEdt", fields: [edtId], references: [id])

  @@map("proyecto_servicio_cotizado_item")
}

model Recurso {
  id                                    String                                  @id @default(cuid())
  nombre                                String                                  @unique
  costoHora                             Float
  createdAt                             DateTime                                @default(now())
  updatedAt                             DateTime                                @updatedAt
  catalogoServicio                      CatalogoServicio[]
  cotizacionServicioItem                CotizacionServicioItem[]
  plantillaServicioItem                 PlantillaServicioItem[]
  registroHoras                   RegistroHoras[]
  plantillaServicioItemIndependiente PlantillaServicioItemIndependiente[]

  @@map("recurso")
}

model RegistroHoras {
  id                       String                   @id
  proyectoId               String
  proyectoServicioId       String
  categoria                String
  nombreServicio           String
  recursoId                String
  recursoNombre            String
  usuarioId                String
  fechaTrabajo             DateTime
  horasTrabajadas          Float
  descripcion              String?
  observaciones            String?
  aprobado                 Boolean                  @default(false)
  proyectoEdtId            String?
  edtId                    String?
  origen                   OrigenTrabajo?
  ubicacion                String?
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  proyectoTareaId          String?
  edt                      Edt?                     @relation(fields: [edtId], references: [id])
  proyectoEdt             ProyectoEdt?            @relation(fields: [proyectoEdtId], references: [id])
  proyecto                 Proyecto                 @relation(fields: [proyectoId], references: [id])
  proyectoServicioCotizado ProyectoServicioCotizado @relation(fields: [proyectoServicioId], references: [id])
  proyectoTarea           ProyectoTarea?          @relation(fields: [proyectoTareaId], references: [id])
  recurso                     Recurso                  @relation(fields: [recursoId], references: [id])
  user                        User                     @relation(fields: [usuarioId], references: [id])

  @@index([edtId, fechaTrabajo])
  @@index([origen, fechaTrabajo])
  @@index([proyectoEdtId, proyectoTareaId, fechaTrabajo])
  @@index([proyectoTareaId, fechaTrabajo])
  @@map("registro_horas")
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user                        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Unidad {
  id             String           @id
  nombre         String           @unique
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  catalogoEquipo CatalogoEquipo[]

  @@map("unidad")
}

model UnidadServicio {
  id                                     String                                  @id
  nombre                                 String                                  @unique
  createdAt                              DateTime                                @default(now())
  updatedAt                              DateTime
  catalogoServicio                       CatalogoServicio[]
  cotizacionServicioItem                 CotizacionServicioItem[]
  plantillaServicioItem                  PlantillaServicioItem[]
  plantillaServicioItemIndependiente     PlantillaServicioItemIndependiente[]

  @@map("unidad_servicio")
}

model User {
  id                                                  String                        @id
  name                                                String?
  email                                               String                        @unique
  emailVerified                                       DateTime?
  password                                            String
  role                                                Role                          @default(colaborador)
  image                                               String?
  metaMensual                                         Float?
  metaTrimestral                                      Float?
  Account                                             Account[]
  cotizacion                  Cotizacion[]
  entregaItem                                         EntregaItem[]
  eventoTrazabilidad              EventoTrazabilidad[]
  listaEquipo                                         ListaEquipo[]
  listaEquipoItem                                     ListaEquipoItem[]
  pedidoEquipo                                        PedidoEquipo[]
  pedidoEquipoItem                                    PedidoEquipoItem[]
  proyectosComoComercial                              Proyecto[]                    @relation("ProyectoComercial")
  proyectosComoGestor                                 Proyecto[]                    @relation("ProyectoGestor")
  proyectosComoSupervisor                             Proyecto[]                    @relation("ProyectoSupervisor")
  proyectosComoLider                                  Proyecto[]                    @relation("ProyectoLider")
  personalProyecto                                    PersonalProyecto[]
  proyectoEquipoCotizado                              ProyectoEquipoCotizado[]
  proyectoServicioCotizado                            ProyectoServicioCotizado[]
  registroHoras                   RegistroHoras[]
  Session                                             Session[]
  asignacionesRecurso                                AsignacionRecurso[]
  auditLog                                           AuditLog[]
  cotizacionEdt                                      CotizacionEdt[]
  cotizacionPlantillaImport                         CotizacionPlantillaImport[]
  cotizacionTarea                                    CotizacionTarea[]
  cotizacionVersion                                  CotizacionVersion[]
  crmActividad                                        CrmActividad[]
  crmMetricaComercial                                 CrmMetricaComercial[]
  crmOportunidadComercial                             CrmOportunidad[]             @relation("CrmOportunidadComercial")
  crmOportunidadResponsable                           CrmOportunidad[]             @relation("CrmOportunidadResponsable")
  metricaComercial                                   MetricaComercial[]
  notificaciones                                      Notificacion[]
  proyectoActividad                                  ProyectoActividad[]
  proyectoEdt                                        ProyectoEdt[]
  proyectoSubtarea                                   ProyectoSubtarea[]
  proyectoTarea                                      ProyectoTarea[]
  registrosProgreso                                  RegistroProgreso[]
  subtareas                                           Subtarea[]
  tareas                                              Tarea[]
  userPermissions                                    UserPermission[]

  @@map("user")
}

model Valorizacion {
  id            String   @id
  proyectoId    String
  nombre        String
  descripcion   String?
  periodoInicio DateTime
  periodoFin    DateTime
  estado        String   @default("pendiente")
  montoTotal    Float
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  proyecto                    Proyecto @relation(fields: [proyectoId], references: [id])

  @@map("valorizacion")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_token")
}

model AnalyticsEvent {
  id        String   @id
  event     String
  category  String
  action    String
  label     String?
  value     Float?
  metadata  Json?
  timestamp DateTime @default(now())
  userId    String?
  sessionId String
  userAgent String
  url       String

  @@index([category, event, timestamp(sort: Desc)])
  @@index([sessionId, timestamp(sort: Desc)])
  @@index([timestamp(sort: Desc)])
  @@index([userId, timestamp(sort: Desc)])
  @@map("analytics_events")
}

model AsignacionRecurso {
  id             String   @id
  rol            String
  horasAsignadas Decimal? @db.Decimal(10, 2)
  tareaId        String
  usuarioId      String
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  tarea         Tarea   @relation(fields: [tareaId], references: [id], onDelete: Cascade)
  user                        User     @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([tareaId, usuarioId])
  @@map("asignaciones_recurso")
}

model AuditLog {
  id          String   @id
  entidadTipo String
  entidadId   String
  accion      String
  usuarioId   String
  descripcion String
  cambios     String?
  metadata    String?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [usuarioId], references: [id])

  @@index([accion, createdAt(sort: Desc)])
  @@index([entidadTipo, entidadId, createdAt(sort: Desc)])
  @@index([usuarioId, createdAt(sort: Desc)])
  @@map("audit_log")
}

model CalendarioLaboral {
  id                       String                     @id
  nombre                   String                     @unique
  descripcion              String?
  pais                     String?
  empresa                  String?
  activo                   Boolean                    @default(true)
  horasPorDia              Float                      @default(8.0)
  diasLaborables           DiaSemana[]
  horaInicioManana         String                     @default("08:00")
  horaFinManana            String                     @default("12:00")
  horaInicioTarde          String                     @default("13:00")
  horaFinTarde             String                     @default("17:00")
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  cotizacion               Cotizacion[]
  configuracionCalendario ConfiguracionCalendario[]
  diaCalendario           DiaCalendario[]
  excepcionCalendario     ExcepcionCalendario[]

  @@map("calendario_laboral")
}

model ConfiguracionCalendario {
  id                       String             @id
  calendarioLaboralId      String
  entidadTipo              String
  entidadId                String
  calendarioPredeterminado Boolean            @default(false)
  calendarioLaboral       CalendarioLaboral @relation(fields: [calendarioLaboralId], references: [id], onDelete: Cascade)

  @@unique([entidadTipo, entidadId])
  @@map("configuracion_calendario")
}

model CotizacionActividad {
  id                   String             @id
  cotizacionEdtId      String
  nombre               String
  orden                Int                @default(0)
  fechaInicioComercial DateTime?
  fechaFinComercial    DateTime?
  estado               EstadoActividad    @default(pendiente)
  porcentajeAvance     Int                @default(0)
  horasEstimadas       Decimal?           @db.Decimal(10, 2)
  descripcion          String?
  prioridad            PrioridadEdt       @default(media)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime
  cotizacionEdt        CotizacionEdt      @relation(fields: [cotizacionEdtId], references: [id], onDelete: Cascade)
  cotizacionTarea      CotizacionTarea[]

  @@index([cotizacionEdtId, orden])
  @@map("cotizacion_actividad")
}

model CotizacionCondicion {
  id           String     @id
  cotizacionId String
  tipo         String?
  descripcion  String
  orden        Int?       @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  cotizacion                  Cotizacion @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)

  @@index([cotizacionId, orden])
  @@map("cotizacion_condicion")
}

model CotizacionDependenciasTarea {
  id                 String           @id
  tareaOrigenId      String
  tareaDependienteId String
  tipo               TipoDependencia  @default(finish_to_start)
  lagMinutos         Int              @default(0)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  tareaDependiente   CotizacionTarea  @relation("dependenciasCotizacionTareaDependiente", fields: [tareaDependienteId], references: [id], onDelete: Cascade)
  tareaOrigen        CotizacionTarea  @relation("dependenciasCotizacionTareaOrigen", fields: [tareaOrigenId], references: [id], onDelete: Cascade)

  @@unique([tareaOrigenId, tareaDependienteId])
  @@map("cotizacion_dependencias_tarea")
}

model CotizacionEdt {
  id                   String                  @id
  cotizacionId         String
  cotizacionServicioId String?
  edtId                String?
  fechaInicioComercial DateTime?
  fechaFinComercial    DateTime?
  horasEstimadas       Decimal?                @default(0) @db.Decimal(10, 2)
  estado               EstadoEdt               @default(planificado)
  responsableId        String?
  descripcion          String?
  prioridad            PrioridadEdt            @default(media)
  createdAt            DateTime                @default(now())
  updatedAt            DateTime
  cotizacionFaseId     String?
  nombre               String
  orden                Int                     @default(0)
  cotizacionActividad  CotizacionActividad[]
  edt                  Edt?                    @relation(fields: [edtId], references: [id])
  cotizacionFase       CotizacionFase?         @relation(fields: [cotizacionFaseId], references: [id])
  cotizacion           Cotizacion              @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)
  cotizacionServicio   CotizacionServicio?     @relation(fields: [cotizacionServicioId], references: [id])
  user                        User?                   @relation(fields: [responsableId], references: [id])

  @@unique([cotizacionId, nombre])
  @@index([cotizacionId, cotizacionServicioId])
  @@index([cotizacionId, orden])
  @@index([estado, fechaFinComercial])
  @@index([responsableId, estado])
  @@map("cotizacion_edt")
}

model CotizacionExclusion {
  id           String     @id
  cotizacionId String
  descripcion  String
  orden        Int?       @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  cotizacion                  Cotizacion @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)

  @@index([cotizacionId, orden])
  @@map("cotizacion_exclusion")
}

model CotizacionFase {
  id               String            @id
  cotizacionId     String
  nombre           String
  descripcion      String?
  orden            Int               @default(0)
  fechaInicioPlan  DateTime?
  fechaFinPlan     DateTime?
  estado           EstadoFase        @default(planificado)
  porcentajeAvance Int               @default(0)
  horasEstimadas   Decimal?          @db.Decimal(10, 2)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  cotizacionEdt    CotizacionEdt[]
  cotizacion                  Cotizacion        @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)

  @@unique([cotizacionId, nombre])
  @@index([cotizacionId, orden])
  @@map("cotizacion_fase")
}

model CotizacionPlantillaImport {
  id               String     @id
  cotizacionId     String
  plantillaId      String
  tipoImportacion  String
  fechaImportacion DateTime   @default(now())
  usuarioId        String
  cotizacion                  Cotizacion @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)
  plantilla                   Plantilla  @relation(fields: [plantillaId], references: [id], onDelete: Cascade)
  user                        User       @relation(fields: [usuarioId], references: [id])

  @@index([cotizacionId, fechaImportacion])
  @@index([plantillaId, tipoImportacion])
  @@map("cotizacion_plantilla_import")
}

model CotizacionTarea {
  id                           String                        @id
  nombre                       String
  descripcion                  String?
  fechaInicio                  DateTime
  fechaFin                     DateTime
  horasEstimadas               Decimal?                      @db.Decimal(10, 2)
  estado                       EstadoTarea                   @default(pendiente)
  prioridad                    PrioridadTarea                @default(media)
  dependenciaId                String?
  responsableId                String?
  createdAt                    DateTime                      @default(now())
  updatedAt                    DateTime
  cotizacionServicioItemId     String?
  cotizacionActividadId        String
  duracionHoras                Decimal?                      @db.Decimal(10, 2)
  esHito                       Boolean                       @default(false)
  orden                        Int                           @default(0)
  dependenciasComoDependiente  CotizacionDependenciasTarea[] @relation("dependenciasCotizacionTareaDependiente")
  dependenciasComoOrigen       CotizacionDependenciasTarea[] @relation("dependenciasCotizacionTareaOrigen")
  cotizacionActividad          CotizacionActividad           @relation(fields: [cotizacionActividadId], references: [id], onDelete: Cascade)
  cotizacionServicioItem       CotizacionServicioItem?       @relation(fields: [cotizacionServicioItemId], references: [id])
  tareaPadre                   CotizacionTarea?              @relation("cotizacionTareaHijas", fields: [dependenciaId], references: [id])
  tareasHijas                  CotizacionTarea[]             @relation("cotizacionTareaHijas")
  user                         User?                         @relation(fields: [responsableId], references: [id])

  @@index([cotizacionActividadId, estado])
  @@index([cotizacionServicioItemId])
  @@index([dependenciaId])
  @@index([responsableId, fechaFin])
  @@map("cotizacion_tarea")
}

model CotizacionVersion {
  id           String     @id
  cotizacionId String
  version      Int
  nombre       String
  descripcion  String?
  estado       String     @default("borrador")
  snapshot     String
  cambios      String?
  motivoCambio String?
  usuarioId    String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  cotizacion                  Cotizacion @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)
  user                        User       @relation(fields: [usuarioId], references: [id])

  @@unique([cotizacionId, version])
  @@index([cotizacionId, version])
  @@index([estado, createdAt])
  @@map("cotizacion_version")
}

model CrmActividad {
  id              String          @id
  oportunidadId   String
  tipo            String
  descripcion     String
  fecha           DateTime
  resultado       String?
  notas           String?
  usuarioId       String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  crmOportunidad  CrmOportunidad  @relation(fields: [oportunidadId], references: [id], onDelete: Cascade)
  user                        User            @relation(fields: [usuarioId], references: [id])

  @@index([oportunidadId, fecha])
  @@map("crm_actividad")
}

model CrmCompetidorLicitacion {
  id                 String     @id
  cotizacionId       String
  nombreEmpresa      String
  contacto           String?
  telefono           String?
  email              String?
  propuestaEconomica Float?
  propuestaTecnica   String?
  fortalezas         String?
  debilidades        String?
  precioVsNuestro    String?
  resultado          String?
  razonPerdida       String?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime
  cotizacion                  Cotizacion @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)

  @@index([cotizacionId])
  @@map("crm_competidor_licitacion")
}

model CrmContactoCliente {
  id                  String    @id
  clienteId           String
  nombre              String
  cargo               String?
  email               String?
  telefono            String?
  celular             String?
  esDecisionMaker     Boolean   @default(false)
  areasInfluencia     String?
  relacionComercial   String?
  fechaUltimoContacto DateTime?
  notas               String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  cliente                     Cliente   @relation(fields: [clienteId], references: [id], onDelete: Cascade)

  @@index([clienteId, esDecisionMaker])
  @@map("crm_contacto_cliente")
}

model CrmHistorialProyecto {
  id                  String      @id
  clienteId           String
  proyectoId          String?
  cotizacionId        String?
  nombreProyecto      String
  tipoProyecto        String
  sector              String?
  complejidad         String?
  valorContrato       Float?
  margenObtenido      Float?
  duracionDias        Int?
  fechaInicio         DateTime?
  fechaFin            DateTime?
  fechaAdjudicacion   DateTime?
  calificacionCliente Int?
  retroalimentacion   String?
  exitos              String?
  problemas           String?
  recomendaciones     String?
  createdAt           DateTime    @default(now())
  updatedAt           DateTime
  cliente                     Cliente     @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  cotizacion          Cotizacion? @relation(fields: [cotizacionId], references: [id])
  proyecto                    Proyecto?   @relation(fields: [proyectoId], references: [id])

  @@index([clienteId, fechaInicio])
  @@index([tipoProyecto, sector])
  @@map("crm_historial_proyecto")
}

model CrmMetricaComercial {
  id                    String   @id
  usuarioId             String
  periodo               String
  cotizacionesGeneradas Int      @default(0)
  cotizacionesAprobadas Int      @default(0)
  proyectosCerrados     Int      @default(0)
  valorTotalVendido     Float    @default(0)
  margenTotalObtenido   Float    @default(0)
  tiempoPromedioCierre  Float?
  tasaConversion        Float?
  valorPromedioProyecto Float?
  llamadasRealizadas    Int      @default(0)
  reunionesAgendadas    Int      @default(0)
  propuestasEnviadas    Int      @default(0)
  emailsEnviados        Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  user                        User     @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, periodo])
  @@index([periodo])
  @@map("crm_metrica_comercial")
}

model CrmOportunidad {
  id                                       String             @id
  clienteId                                String
  nombre                                   String
  descripcion                              String?
  valorEstimado                            Float?
  probabilidad                             Int                @default(0)
  fechaCierreEstimada                      DateTime?
  fuente                                   String?
  prioridad                                String             @default("media")
  comercialId                              String?
  responsableId                            String?
  fechaUltimoContacto                      DateTime?
  notas                                    String?
  competencia                              String?
  createdAt                                DateTime           @default(now())
  updatedAt                                DateTime
  cotizacionId                             String?            @unique
  proyectoId                               String?
  estado                                   EstadoOportunidad  @default(prospecto)
  crmActividad                             CrmActividad[]
  cliente                     Cliente            @relation(fields: [clienteId], references: [id])
  comercial                                User?              @relation("CrmOportunidadComercial", fields: [comercialId], references: [id])
  cotizacion                  Cotizacion?        @relation(fields: [cotizacionId], references: [id])
  proyecto                    Proyecto?          @relation(fields: [proyectoId], references: [id])
  responsable                              User?              @relation("CrmOportunidadResponsable", fields: [responsableId], references: [id])

  @@index([clienteId, estado])
  @@index([comercialId, fechaCierreEstimada])
  @@map("crm_oportunidad")
}

model DependenciasTarea {
  id                 String          @id
  tipo               TipoDependencia @default(finish_to_start)
  tareaOrigenId      String
  tareaDependienteId String
  createdAt          DateTime        @default(now())
  tareaDependiente   Tarea           @relation("dependenciasTareaDependiente", fields: [tareaDependienteId], references: [id], onDelete: Cascade)
  tareaOrigen        Tarea           @relation("dependenciasTareaOrigen", fields: [tareaOrigenId], references: [id], onDelete: Cascade)

  @@unique([tareaOrigenId, tareaDependienteId])
  @@map("dependencias_tarea")
}

model DiaCalendario {
  id                  String             @id
  calendarioLaboralId String
  diaSemana           DiaSemana
  esLaborable         Boolean            @default(true)
  horaInicioManana    String?
  horaFinManana       String?
  horaInicioTarde     String?
  horaFinTarde        String?
  horasTotales        Float?
  calendarioLaboral  CalendarioLaboral @relation(fields: [calendarioLaboralId], references: [id], onDelete: Cascade)

  @@unique([calendarioLaboralId, diaSemana])
  @@map("dia_calendario")
}

model Edt {
  id                                  String                               @id(map: "CategoriaServicio_pkey") @default(cuid())
  nombre                              String                               @unique(map: "CategoriaServicio_nombre_key")
  createdAt                           DateTime                             @default(now())
  updatedAt                           DateTime                             @updatedAt
  descripcion                         String?
  faseDefaultId                       String?
  catalogoServicio                    CatalogoServicio[]
  cotizacionServicio                  CotizacionServicio[]                 @relation("CotizacionServicioEdt")
  cotizacionServicioItem              CotizacionServicioItem[]             @relation("CotizacionServicioItemEdt")
  registroHoras                       RegistroHoras[]
  cotizacionEdt                       CotizacionEdt[]
  faseDefault                         FaseDefault?                         @relation(fields: [faseDefaultId], references: [id], map: "CategoriaServicio_faseDefaultId_fkey")
  proyectoEdt                         ProyectoEdt[]
  proyectoServicioCotizado            ProyectoServicioCotizado[]           @relation("ProyectoServicioCotizadoEdt")
  proyectoServicioCotizadoItem        ProyectoServicioCotizadoItem[]       @relation("ProyectoServicioCotizadoItemEdt")
  plantillaServicioIndependiente      PlantillaServicioIndependiente[]     @relation("PlantillaServicioIndependienteEdt")
  plantillaServicioItemIndependiente  PlantillaServicioItemIndependiente[] @relation("PlantillaServicioItemIndependienteEdt")

  @@map("edt")
}

model ExcepcionCalendario {
  id                  String             @id
  calendarioLaboralId String
  fecha               DateTime
  tipo                TipoExcepcion
  nombre              String
  descripcion         String?
  horaInicio          String?
  horaFin             String?
  horasTotales        Float?
  calendarioLaboral  CalendarioLaboral @relation(fields: [calendarioLaboralId], references: [id], onDelete: Cascade)

  @@unique([calendarioLaboralId, fecha])
  @@map("excepcion_calendario")
}

model FaseDefault {
  id           String   @id
  nombre       String   @unique
  descripcion  String?
  orden        Int      @default(0)
  activo       Boolean  @default(true)
  duracionDias Int
  color        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  edt          Edt[]

  @@index([activo])
  @@index([orden])
  @@map("fase_default")
}

model MetricaComercial {
  id                    String   @id
  usuarioId             String
  periodo               String
  tipo                  String
  cotizacionesGeneradas Int      @default(0)
  cotizacionesAprobadas Int      @default(0)
  proyectosCerrados     Int      @default(0)
  valorTotalVendido     Float    @default(0)
  margenTotalObtenido   Float    @default(0)
  tiempoPromedioCierre  Float?
  tasaConversion        Float?
  valorPromedioProyecto Float?
  llamadasRealizadas    Int      @default(0)
  reunionesAgendadas    Int      @default(0)
  propuestasEnviadas    Int      @default(0)
  emailsEnviados        Int      @default(0)
  oportunidadesCreadas  Int      @default(0)
  oportunidadesGanadas  Int      @default(0)
  oportunidadesPerdidas Int      @default(0)
  actividadesRealizadas Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  user                        User     @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, periodo, tipo])
  @@index([periodo, tipo])
  @@index([usuarioId, tipo])
  @@map("metrica_comercial")
}

model Notificacion {
  id           String                @id
  titulo       String
  mensaje      String
  tipo         TipoNotificacion      @default(info)
  prioridad    PrioridadNotificacion @default(media)
  usuarioId    String
  entidadTipo  String?
  entidadId    String?
  leida        Boolean               @default(false)
  fechaLectura DateTime?
  accionUrl    String?
  accionTexto  String?
  createdAt    DateTime              @default(now())
  updatedAt    DateTime
  user                        User                  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([entidadTipo, entidadId])
  @@index([usuarioId, leida, createdAt(sort: Desc)])
  @@map("notificaciones")
}

model Permission {
  id                 String             @id
  name               String             @unique
  description        String?
  resource           String
  action             String
  isSystemPermission Boolean            @default(true)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  userPermissions   UserPermission[]

  @@index([resource, action])
  @@map("permissions")
}

model PlantillaCondicion {
  id                       String                     @id
  nombre                   String
  descripcion              String?
  categoria                String?
  tipo                     String?
  activo                   Boolean                    @default(true)
  orden                    Int                        @default(0)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  plantillaCondicionItem   PlantillaCondicionItem[]

  @@index([categoria, tipo, activo])
  @@map("plantilla_condicion")
}

model PlantillaCondicionItem {
  id                   String               @id
  plantillaCondicionId String
  descripcion          String
  tipo                 String?
  orden                Int                  @default(0)
  activo               Boolean              @default(true)
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  plantillaCondicion   PlantillaCondicion   @relation(fields: [plantillaCondicionId], references: [id], onDelete: Cascade)

  @@index([plantillaCondicionId, orden])
  @@map("plantilla_condicion_item")
}

model PlantillaDuracionCronograma {
  id               String   @id
  nivel            String   @unique
  duracionDias     Float
  horasPorDia      Int      @default(8)
  bufferPorcentaje Float    @default(10.0)
  activo           Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime

  @@map("plantilla_duracion_cronograma")
}

model PlantillaEquipoIndependiente {
  id                                  String                                @id
  nombre                              String
  descripcion                         String?
  estado                              String                                @default("borrador")
  totalInterno                        Float                                 @default(0)
  totalCliente                        Float                                 @default(0)
  descuento                           Float                                 @default(0)
  grandTotal                          Float                                 @default(0)
  createdAt                           DateTime                              @default(now())
  updatedAt                           DateTime
  plantillaEquipoItemIndependiente    PlantillaEquipoItemIndependiente[]

  @@map("plantilla_equipo_independiente")
}

model PlantillaEquipoItemIndependiente {
  id                             String                         @id
  plantillaEquipoId              String
  catalogoEquipoId               String?
  codigo                         String
  descripcion                    String
  categoria                      String
  unidad                         String
  marca                          String
  precioInterno                  Float
  precioCliente                  Float
  cantidad                       Float
  costoInterno                   Float
  costoCliente                   Float
  createdAt                      DateTime                       @default(now())
  updatedAt                      DateTime
  catalogoEquipo                 CatalogoEquipo?                @relation(fields: [catalogoEquipoId], references: [id])
  plantillaEquipoIndependiente   PlantillaEquipoIndependiente   @relation(fields: [plantillaEquipoId], references: [id], onDelete: Cascade)

  @@map("plantilla_equipo_item_independiente")
}

model PlantillaExclusion {
  id                       String                     @id
  nombre                   String
  descripcion              String?
  categoria                String?
  activo                   Boolean                    @default(true)
  orden                    Int                        @default(0)
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  plantillaExclusionItem   PlantillaExclusionItem[]

  @@index([categoria, activo])
  @@map("plantilla_exclusion")
}

model PlantillaExclusionItem {
  id                   String               @id
  plantillaExclusionId String
  descripcion          String
  orden                Int                  @default(0)
  activo               Boolean              @default(true)
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  plantillaExclusion   PlantillaExclusion   @relation(fields: [plantillaExclusionId], references: [id], onDelete: Cascade)

  @@index([plantillaExclusionId, orden])
  @@map("plantilla_exclusion_item")
}

model PlantillaGastoIndependiente {
  id                                 String                               @id
  nombre                             String
  descripcion                        String?
  estado                             String                               @default("borrador")
  totalInterno                       Float                                @default(0)
  totalCliente                       Float                                @default(0)
  descuento                          Float                                @default(0)
  grandTotal                         Float                                @default(0)
  createdAt                          DateTime                             @default(now())
  updatedAt                          DateTime
  plantillaGastoItemIndependiente    PlantillaGastoItemIndependiente[]

  @@map("plantilla_gasto_independiente")
}

model PlantillaGastoItemIndependiente {
  id                            String                        @id
  plantillaGastoId              String
  nombre                        String
  descripcion                   String?
  cantidad                      Float
  precioUnitario                Float
  factorSeguridad               Float                         @default(1.0)
  margen                        Float                         @default(1.0)
  costoInterno                  Float
  costoCliente                  Float
  createdAt                     DateTime                      @default(now())
  updatedAt                     DateTime
  plantillaGastoIndependiente   PlantillaGastoIndependiente   @relation(fields: [plantillaGastoId], references: [id], onDelete: Cascade)

  @@map("plantilla_gasto_item_independiente")
}

model PlantillaServicioIndependiente {
  id                                    String                                  @id
  nombre                                String
  descripcion                           String?
  edtId                                 String?
  estado                                String                                  @default("borrador")
  totalInterno                          Float                                   @default(0)
  totalCliente                          Float                                   @default(0)
  descuento                             Float                                   @default(0)
  grandTotal                            Float                                   @default(0)
  createdAt                             DateTime                                @default(now())
  updatedAt                             DateTime
  edt                                   Edt?                                    @relation("PlantillaServicioIndependienteEdt", fields: [edtId], references: [id])
  plantillaServicioItemIndependiente    PlantillaServicioItemIndependiente[]

  @@map("plantilla_servicio_independiente")
}

model PlantillaServicioItemIndependiente {
  id                               String                           @id
  plantillaServicioId              String
  catalogoServicioId               String?
  unidadServicioId                 String
  recursoId                        String
  edtId                            String?
  nombre                           String
  descripcion                      String
  unidadServicioNombre             String
  recursoNombre                    String
  formula                          String
  horaBase                         Float?
  horaRepetido                     Float?
  horaUnidad                       Float?
  horaFijo                         Float?
  costoHora                        Float
  cantidad                         Int
  horaTotal                        Float
  factorSeguridad                  Float
  margen                           Float
  costoInterno                     Float
  costoCliente                     Float
  orden                            Int?                             @default(0)
  createdAt                        DateTime                         @default(now())
  updatedAt                        DateTime
  catalogoServicio                 CatalogoServicio?                @relation(fields: [catalogoServicioId], references: [id])
  edt                              Edt?                             @relation("PlantillaServicioItemIndependienteEdt", fields: [edtId], references: [id])
  plantillaServicioIndependiente   PlantillaServicioIndependiente   @relation(fields: [plantillaServicioId], references: [id], onDelete: Cascade)
  recurso                          Recurso                          @relation(fields: [recursoId], references: [id])
  unidadServicio                   UnidadServicio                   @relation(fields: [unidadServicioId], references: [id])

  @@map("plantilla_servicio_item_independiente")
}

model ProyectoActividad {
  id                   String              @id
  proyectoEdtId        String
  proyectoCronogramaId String
  nombre               String
  orden                Int                 @default(0)
  responsableId        String?
  fechaInicioPlan      DateTime
  fechaFinPlan         DateTime
  fechaInicioReal      DateTime?
  fechaFinReal         DateTime?
  estado               EstadoActividad     @default(pendiente)
  porcentajeAvance     Int                 @default(0)
  horasPlan            Decimal?            @db.Decimal(10, 2)
  horasReales          Decimal             @default(0) @db.Decimal(10, 2)
  descripcion          String?
  prioridad            PrioridadEdt        @default(media)
  createdAt            DateTime            @default(now())
  updatedAt            DateTime
  proyectoCronograma   ProyectoCronograma @relation(fields: [proyectoCronogramaId], references: [id], onDelete: Cascade)
  proyectoEdt          ProyectoEdt        @relation(fields: [proyectoEdtId], references: [id], onDelete: Cascade)
  user                        User?               @relation(fields: [responsableId], references: [id])
  proyectoTarea        ProyectoTarea[]

  @@index([proyectoEdtId, proyectoCronogramaId])
  @@index([proyectoEdtId, proyectoCronogramaId, orden])
  @@map("proyecto_actividad")
}

model ProyectoCronograma {
  id                       String               @id
  proyectoId               String
  tipo                     String
  nombre                   String
  copiadoDesdeCotizacionId String?              @unique
  esBaseline               Boolean              @default(false)
  version                  Int                  @default(1)
  createdAt                DateTime             @default(now())
  updatedAt                DateTime
  proyectoActividad        ProyectoActividad[]
  proyecto                 Proyecto             @relation(fields: [proyectoId], references: [id], onDelete: Cascade)
  proyectoEdt              ProyectoEdt[]
  proyectoFase             ProyectoFase[]
  proyectoTarea            ProyectoTarea[]

  @@unique([proyectoId, tipo])
  @@index([proyectoId, tipo])
  @@map("proyecto_cronograma")
}

model ProyectoDependenciasTarea {
  id                 String          @id
  tipo               TipoDependencia @default(finish_to_start)
  tareaOrigenId      String
  tareaDependienteId String
  createdAt          DateTime        @default(now())
  tareaDependiente   ProyectoTarea   @relation("dependenciasTareaDependiente", fields: [tareaDependienteId], references: [id], onDelete: Cascade)
  tareaOrigen        ProyectoTarea   @relation("dependenciasTareaOrigen", fields: [tareaOrigenId], references: [id], onDelete: Cascade)

  @@unique([tareaOrigenId, tareaDependienteId])
  @@map("proyecto_dependencias_tarea")
}

model ProyectoEdt {
  id                   String               @id
  proyectoId           String
  edtId                String
  fechaInicioPlan      DateTime?
  fechaFinPlan         DateTime?
  horasPlan            Decimal?             @default(0) @db.Decimal(10, 2)
  fechaInicioReal      DateTime?
  fechaFinReal         DateTime?
  horasReales          Decimal              @default(0) @db.Decimal(10, 2)
  estado               EstadoEdt            @default(planificado)
  responsableId        String?
  porcentajeAvance     Int                  @default(0)
  descripcion          String?
  prioridad            PrioridadEdt         @default(media)
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  nombre               String
  orden                Int                  @default(0)
  proyectoCronogramaId String
  proyectoFaseId       String?
  registroHoras                   RegistroHoras[]
  proyectoActividad    ProyectoActividad[]
  edt                  Edt                  @relation(fields: [edtId], references: [id])
  proyectoCronograma   ProyectoCronograma  @relation(fields: [proyectoCronogramaId], references: [id], onDelete: Cascade)
  proyectoFase         ProyectoFase?       @relation(fields: [proyectoFaseId], references: [id])
  proyecto                    Proyecto             @relation(fields: [proyectoId], references: [id], onDelete: Cascade)
  user                        User?                @relation(fields: [responsableId], references: [id])
  proyectoTarea        ProyectoTarea[]

  @@unique([proyectoId, proyectoCronogramaId, nombre])
  @@index([estado, fechaFinPlan])
  @@index([proyectoId, proyectoCronogramaId, orden])
  @@index([responsableId, estado])
  @@map("proyecto_edt")
}

model ProyectoFase {
  id                   String              @id
  proyectoId           String
  proyectoCronogramaId String
  nombre               String
  descripcion          String?
  orden                Int                 @default(0)
  fechaInicioPlan      DateTime?
  fechaFinPlan         DateTime?
  fechaInicioReal      DateTime?
  fechaFinReal         DateTime?
  estado               EstadoFase          @default(planificado)
  porcentajeAvance     Int                 @default(0)
  createdAt            DateTime            @default(now())
  updatedAt            DateTime
  proyectoEdt          ProyectoEdt[]
  proyectoCronograma   ProyectoCronograma @relation(fields: [proyectoCronogramaId], references: [id], onDelete: Cascade)
  proyecto                    Proyecto            @relation(fields: [proyectoId], references: [id], onDelete: Cascade)

  @@unique([proyectoId, proyectoCronogramaId, nombre])
  @@index([proyectoId, proyectoCronogramaId, orden])
  @@map("proyecto_fase")
}

model ProyectoSubtarea {
  id                   String         @id
  nombre               String
  descripcion          String?
  fechaInicio          DateTime
  fechaFin             DateTime
  fechaInicioReal      DateTime?
  fechaFinReal         DateTime?
  estado               EstadoTarea    @default(pendiente)
  porcentajeCompletado Int            @default(0)
  horasEstimadas       Decimal?       @db.Decimal(10, 2)
  horasReales          Decimal?       @default(0) @db.Decimal(10, 2)
  proyectoTareaId      String
  asignadoId           String?
  createdAt            DateTime       @default(now())
  updatedAt            DateTime
  user                        User?          @relation(fields: [asignadoId], references: [id])
  proyectoTarea        ProyectoTarea @relation(fields: [proyectoTareaId], references: [id], onDelete: Cascade)

  @@map("proyecto_subtarea")
}

model ProyectoTarea {
  id                                                                                         String                        @id
  proyectoEdtId                                                                              String
  proyectoCronogramaId                                                                       String
  nombre                                                                                     String
  descripcion                                                                                String?
  orden                                                                                      Int                           @default(0)
  fechaInicio                                                                                DateTime
  fechaFin                                                                                   DateTime
  fechaInicioReal                                                                            DateTime?
  fechaFinReal                                                                               DateTime?
  horasEstimadas                                                                             Decimal?                      @db.Decimal(10, 2)
  horasReales                                                                                Decimal                       @default(0) @db.Decimal(10, 2)
  estado                                                                                     EstadoTarea                   @default(pendiente)
  prioridad                                                                                  PrioridadTarea                @default(media)
  porcentajeCompletado                                                                       Int                           @default(0)
  dependenciaId                                                                              String?
  responsableId                                                                              String?
  proyectoActividadId                                                                        String?
  createdAt                                                                                  DateTime                      @default(now())
  updatedAt                                                                                  DateTime
  registroHoras                RegistroHoras[]
  dependenciasComoDependiente  ProyectoDependenciasTarea[]  @relation("dependenciasTareaDependiente")
  dependenciasComoOrigen       ProyectoDependenciasTarea[]  @relation("dependenciasTareaOrigen")
  proyectoSubtarea             ProyectoSubtarea[]
  tareaPadre                   ProyectoTarea?               @relation("proyectoTareaHijas", fields: [dependenciaId], references: [id])
  tareasHijas                  ProyectoTarea[]              @relation("proyectoTareaHijas")
  proyectoActividad            ProyectoActividad?           @relation(fields: [proyectoActividadId], references: [id])
  proyectoCronograma           ProyectoCronograma           @relation(fields: [proyectoCronogramaId], references: [id], onDelete: Cascade)
  proyectoEdt                  ProyectoEdt                  @relation(fields: [proyectoEdtId], references: [id], onDelete: Cascade)
  user                         User?                        @relation(fields: [responsableId], references: [id])

  @@index([dependenciaId])
  @@index([proyectoActividadId])
  @@index([proyectoActividadId, orden])
  @@index([proyectoEdtId, estado])
  @@index([proyectoEdtId, orden])
  @@index([responsableId, fechaFin])
  @@map("proyecto_tarea")
}

model RegistroProgreso {
  id                   String     @id
  fecha                DateTime   @default(now())
  horasTrabajadas      Decimal    @db.Decimal(10, 2)
  descripcion          String?
  porcentajeCompletado Int?
  tareaId              String?
  subtareaId           String?
  usuarioId            String
  createdAt            DateTime   @default(now())
  subtarea            Subtarea? @relation(fields: [subtareaId], references: [id], onDelete: Cascade)
  tarea               Tarea?    @relation(fields: [tareaId], references: [id], onDelete: Cascade)
  user                        User       @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("registros_progreso")
}

model Subtarea {
  id                   String               @id
  nombre               String
  descripcion          String?
  fechaInicio          DateTime
  fechaFin             DateTime
  fechaInicioReal      DateTime?
  fechaFinReal         DateTime?
  estado               EstadoTarea          @default(pendiente)
  porcentajeCompletado Int                  @default(0)
  horasEstimadas       Decimal?             @db.Decimal(10, 2)
  horasReales          Decimal?             @default(0) @db.Decimal(10, 2)
  tareaId              String
  asignadoId           String?
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  registrosProgreso    RegistroProgreso[]
  user                        User?                @relation(fields: [asignadoId], references: [id])
  tarea                Tarea               @relation(fields: [tareaId], references: [id], onDelete: Cascade)

  @@map("subtareas")
}

model Tarea {
  id                          String                   @id
  nombre                      String
  descripcion                 String?
  fechaInicio                 DateTime
  fechaFin                    DateTime
  fechaInicioReal             DateTime?
  fechaFinReal                DateTime?
  estado                      EstadoTarea              @default(pendiente)
  prioridad                   PrioridadTarea           @default(media)
  porcentajeCompletado        Int                      @default(0)
  horasEstimadas              Decimal?                 @db.Decimal(10, 2)
  horasReales                 Decimal?                 @default(0) @db.Decimal(10, 2)
  proyectoServicioId          String
  responsableId               String?
  createdAt                   DateTime                 @default(now())
  updatedAt                   DateTime
  asignacionesRecurso         AsignacionRecurso[]
  dependenciasComoDependiente DependenciasTarea[]      @relation("dependenciasTareaDependiente")
  dependenciasComoOrigen      DependenciasTarea[]      @relation("dependenciasTareaOrigen")
  registrosProgreso           RegistroProgreso[]
  subtareas                   Subtarea[]
  proyectoServicioCotizado    ProyectoServicioCotizado @relation(fields: [proyectoServicioId], references: [id], onDelete: Cascade)
  user                        User?                    @relation(fields: [responsableId], references: [id])

  @@map("tareas")
}

model UserPermission {
  id           String      @id
  userId       String
  permissionId String
  type         String
  createdBy    String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime
  permission  Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  user                        User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId])
  @@index([permissionId])
  @@index([userId])
  @@map("user_permissions")
}

enum DiaSemana {
  lunes
  martes
  miercoles
  jueves
  viernes
  sabado
  domingo
}

enum EstadoActividad {
  pendiente
  en_progreso
  completada
  pausada
  cancelada
}

enum EstadoCotizacion {
  borrador
  enviada
  aprobada
  rechazada
}

enum EstadoCotizacionProveedor {
  pendiente
  solicitado
  cotizado
  rechazado
  seleccionado
}

enum EstadoEdt {
  planificado
  en_progreso
  detenido
  completado
  cancelado
  pausado
}

enum EstadoEntregaItem {
  pendiente
  en_proceso
  parcial
  entregado
  retrasado
  cancelado
}

enum EstadoEquipo {
  pendiente
  revisado_tecnico
  aprobado_coordinador
  aprobado_gestor
  en_lista
  comprado
  reemplazado
  entregado
}

enum EstadoEquipoItem {
  pendiente
  en_lista
  reemplazado
  descartado
}

enum EstadoFase {
  planificado
  en_progreso
  completado
  pausado
  cancelado
}

enum EstadoListaEquipo {
  borrador
  enviada
  por_revisar
  por_cotizar
  por_validar
  por_aprobar
  aprobada
  rechazada
  completada
}

enum EstadoListaItem {
  borrador
  por_revisar
  por_cotizar
  por_validar
  por_aprobar
  aprobado
  rechazado
}

enum EstadoOportunidad {
  prospecto
  contacto_inicial
  propuesta_enviada
  negociacion
  cerrada_ganada
  cerrada_perdida
}

enum EstadoPedido {
  borrador
  enviado
  atendido
  parcial
  entregado
  cancelado
}

enum EstadoPedidoItem {
  pendiente
  atendido
  parcial
  entregado
}

enum EstadoTarea {
  pendiente
  en_progreso
  completada
  pausada
  cancelada
}

enum OrigenListaItem {
  cotizado
  nuevo
  reemplazo
}

enum OrigenTrabajo {
  oficina
  campo
}

enum PlantillaTipo {
  completa
  equipos
  servicios
  gastos
}

enum PrioridadEdt {
  baja
  media
  alta
  critica
}

enum PrioridadNotificacion {
  baja
  media
  alta
  critica
}

enum PrioridadTarea {
  baja
  media
  alta
  critica
}

enum ProyectoEstado {
  creado              // 1. Creado por Comercial (desde cotizaci√≥n aprobada)
  en_planificacion    // 2. Elaboraci√≥n del cronograma
  listas_pendientes   // 3. Elaboraci√≥n de listas t√©cnicas
  listas_aprobadas    // 4. Listas aprobadas
  pedidos_creados     // 5. Pedidos de compra creados
  en_ejecucion        // 6. En campo / ejecuci√≥n
  en_cierre           // 7. Proceso de cierre
  cerrado             // 8. Proyecto cerrado
  pausado             // Estado especial: pausado
  cancelado           // Estado especial: cancelado
}

enum Role {
  colaborador
  comercial
  presupuestos
  proyectos
  coordinador
  logistico
  gestor
  gerente
  admin
}

enum TipoDependencia {
  finish_to_start
  start_to_start
  finish_to_finish
  start_to_finish
}

enum TipoExcepcion {
  feriado
  dia_laboral_extra
  dia_no_laboral
}

enum TipoNotificacion {
  info
  warning
  success
  error
}
